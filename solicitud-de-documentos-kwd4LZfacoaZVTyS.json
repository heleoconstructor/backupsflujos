{"createdAt":"2025-08-07T18:15:24.270Z","updatedAt":"2025-10-22T13:54:24.102Z","id":"kwd4LZfacoaZVTyS","name":"Solicitud de documentos","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-32,-112],"id":"46aa3cba-3488-4690-a01c-5645058b2a05","name":"Webhook","webhookId":"6331856f-91e3-4520-b3e5-add42321b412"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.requerimiento }}","rightValue":"Nota de credito","operator":{"type":"string","operation":"equals"},"id":"bbbd0805-c7f6-4946-82e7-aca1e35ca9d3"}],"combinator":"and"},"renameOutput":true,"outputKey":"Nota de credito"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"88f6692a-cfb7-4fc4-ac0d-79ded889b63d","leftValue":"={{ $json.requerimiento }}","rightValue":"Anulación de Comprobante","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Comprobante"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"51ab55c3-a7d0-4de2-aaf2-623698eab26a","leftValue":"={{ $json.requerimiento }}","rightValue":"Anulación de Guia de Remisión","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Guia"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[320,-128],"id":"edf95bad-2d93-425a-b9e8-1f2575f1ac64","name":"Switch","alwaysOutputData":false},{"parameters":{"assignments":{"assignments":[{"id":"ee4f67d0-1b07-4655-8a43-b1194d99b666","name":"id","value":"={{ $json.body.data.rows[0].Id }}","type":"number"},{"id":"c3742b47-9602-4c52-b768-df27630f46c2","name":"requerimiento","value":"={{ $json.body.data.rows[0].Requerimiento }}","type":"string"},{"id":"76f13308-42cb-4b8f-be79-26c0fe8fd609","name":"=guia","value":"={{ $json.body.data.rows[0]['Numero de Guia'] || ' '}}","type":"string"},{"id":"364eb360-95b1-4614-b1ce-6059379e53cf","name":"comprobante","value":"={{ $json.body.data.rows[0]['Numero de Comprobante'] || ' ' }}","type":"string"},{"id":"0229a774-bdfd-46f1-bdf3-4478487bbbd6","name":"nuevo comprobante","value":"={{ $json.body.data.rows[0]['Nuevo Comprobante'] || ' ' }}","type":"string"},{"id":"b902d704-cefe-43d4-803a-a2b0ddf165ff","name":"motivo anulacion","value":"={{ $json.body.data.rows[0]['Motivo de Anulacion'] || ' ' }}","type":"string"},{"id":"cbe05ff6-d786-4453-8b6d-a533f21aa531","name":"cliente","value":"={{ $json.body.data.rows[0]['Nombre Cliente'] || ' ' }}","type":"string"},{"id":"5f656526-e545-401f-92c4-6b41a1f268c2","name":"motivo nc","value":"={{ $json.body.data.rows[0].Motivo || ' '}}","type":"string"},{"id":"f943ca70-4a10-456f-aaa3-a095b572abb5","name":"mercaderia","value":"={{ $json.body.data.rows[0].Mercaderia || ' '}}","type":"string"},{"id":"707da941-c905-44df-a8ea-0aabba9a7cfe","name":"solicitante","value":"={{ $json.body.data.rows[0].Solicitante }}","type":"string"},{"id":"57ce74ec-bf1e-486d-8d57-253f2bddae92","name":"correo solicitante","value":"={{ $json.body.data.rows[0].Correo }}","type":"string"},{"id":"b65ccad9-d4d3-4786-8277-373b95940912","name":"estado  mercaderia","value":"={{ $json.body.data.rows[0]['Estado de la Mercaderia'] || ' '}}","type":"string"},{"id":"67b2c232-b107-4d67-85e0-42590e558998","name":"autorizador","value":"={{ $json.body.data.rows[0].Autorizador || ' '}}","type":"string"},{"id":"280fec3d-b5f7-460f-afc3-bb809937e8a3","name":"importe","value":"={{ $json.body.data.rows[0]['Importe Comprobante'] || ' '}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[144,-112],"id":"841d7869-8264-4b81-921b-55c5c976b360","name":"valores cargados","alwaysOutputData":true},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Solicitud de Anulación de Comprobante</title>\n  <meta name=\"x-apple-disable-message-reformatting\">\n</head>\n<body style=\"margin:0; padding:0; background:#f8f9fa;\">\n  <!-- Fondo general -->\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%; border-collapse:collapse; background:#f8f9fa;\">\n    <tr>\n      <td align=\"center\" style=\"padding:20px 10px;\">\n\n        <!--[if mso | IE]>\n        <table role=\"presentation\" width=\"600\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n          <tr><td>\n        <![endif]-->\n\n        <!-- Contenedor blanco -->\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"600\"\n               style=\"width:600px; max-width:600px; min-width:600px; border-collapse:separate; border:1px solid #e0e0e0; border-radius:8px; background:#ffffff;\">\n          <tr>\n            <td style=\"padding:20px; font-family:Arial, Helvetica, sans-serif; color:#333;\">\n\n              <h2 style=\"margin:0 0 20px; font-size:22px; line-height:1.3; text-align:center; color:#0056b3;\">\n                Solicitud de Anulación de Comprobante\n              </h2>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Solicitado por:</strong> {{ $json.solicitante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Guía:</strong> {{ $json.guia }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Comprobante:</strong> {{ $json.comprobante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Importe de Comprobante:</strong> {{ $json.importe }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Comprobante de Reemplazo:</strong> {{ $json['nuevo comprobante'] }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Motivo de Anulación:</strong><br>\n                {{ $json['motivo anulacion'] }}\n              </div>\n\n              <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                PUEDE HACER SEGUIMIENTO DE LAS SOLICITUDES EN EL SIGUIENTE LINK:\n                <a href=\"https://link.heleo.com.pe/seguimiento_solicitudes\" style=\"color: #888888;\">https://link.heleo.com.pe/seguimiento_solicitudes</a>\n              </div>\n              \n              <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                Este mensaje fue generado automáticamente a partir de un formulario de solicitudes.\n                 <a href=\"https://link.heleo.com.pe/solicitudes_documentos\" style=\"color: #888888;\">https://link.heleo.com.pe/solicitudes_documentos</a>\n              </div>\n\n            </td>\n          </tr>\n        </table>\n\n        <!--[if mso | IE]>\n          </td></tr>\n        </table>\n        <![endif]-->\n\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[672,352],"id":"1da69ef3-5fd9-4835-92d6-57186cbccb7f","name":"anulacion comprobantes","alwaysOutputData":true,"notesInFlow":false},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Solicitud de Anulación de Guía de Remisión</title>\n  <meta name=\"x-apple-disable-message-reformatting\">\n</head>\n<body style=\"margin:0; padding:0; background:#f8f9fa;\">\n  <!-- Fondo general -->\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%; border-collapse:collapse; background:#f8f9fa;\">\n    <tr>\n      <td align=\"center\" style=\"padding:20px 10px;\">\n\n        <!--[if mso | IE]>\n        <table role=\"presentation\" width=\"600\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n          <tr><td>\n        <![endif]-->\n\n        <!-- Contenedor principal -->\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"600\"\n               style=\"width:600px; max-width:600px; min-width:600px; border-collapse:separate; border:1px solid #e0e0e0; border-radius:8px; background:#ffffff;\">\n          <tr>\n            <td style=\"padding:20px; font-family:Arial, Helvetica, sans-serif; color:#333;\">\n\n              <h2 style=\"margin:0 0 20px; font-size:22px; line-height:1.3; text-align:center; color:#0056b3;\">\n                Solicitud de Anulación de Guía de Remisión\n              </h2>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Solicitado por:</strong> {{ $json.solicitante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Guía:</strong> {{ $json.guia }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Motivo de Anulación:</strong> {{ $json['motivo anulacion'] }}\n              </div>\n\n              <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                PUEDE HACER SEGUIMIENTO DE LAS SOLICITUDES EN EL SIGUIENTE LINK:\n                <a href=\"https://link.heleo.com.pe/seguimiento_solicitudes\" style=\"color: #888888;\">https://link.heleo.com.pe/seguimiento_solicitudes</a>\n              </div>\n              \n              <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                Este mensaje fue generado automáticamente a partir de un formulario de solicitud.\n                 <a href=\"https://link.heleo.com.pe/solicitudes_documentos\" style=\"color: #888888;\">https://link.heleo.com.pe/solicitudes_documentos</a>\n              </div>\n\n            </td>\n          </tr>\n        </table>\n\n        <!--[if mso | IE]>\n          </td></tr>\n        </table>\n        <![endif]-->\n\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1392,1008],"id":"8d901018-1a0a-4d17-abfd-e2407aca3bb5","name":"anulacion de guia","alwaysOutputData":false},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Solicitud de Generación de Nota de Crédito</title>\n  <meta name=\"x-apple-disable-message-reformatting\">\n</head>\n<body style=\"margin:0; padding:0; background:#f8f9fa;\">\n  <!-- Wrapper a 100% para fondo -->\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%; border-collapse:collapse; background:#f8f9fa;\">\n    <tr>\n      <td align=\"center\" style=\"padding:20px 10px;\">\n        \n        <!--[if mso | IE]>\n        <table role=\"presentation\" width=\"650\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n          <tr><td>\n        <![endif]-->\n\n        <!-- Contenedor fijo 650px -->\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"650\" \n               style=\"width:650px; max-width:650px; min-width:650px; border-collapse:separate; border:1px solid #e0e0e0; border-radius:8px; background:#ffffff;\">\n          <tr>\n            <td style=\"padding:20px; font-family:Arial, Helvetica, sans-serif; color:#333;\">\n              \n              <h2 style=\"margin:0 0 20px; font-size:22px; line-height:1.3; text-align:center; color:#0056b3;\">\n                Solicitud de Generación de Nota de Crédito\n              </h2>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Solicitado por:</strong> {{ $json.solicitante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Autorizado por:</strong> {{ $json.autorizador }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Comprobante:</strong> {{ $json.comprobante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Estado de la Mercadería:</strong> {{ $json['estado  mercaderia'] }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Nombre Cliente:</strong> {{ $json.cliente }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Motivo:</strong> {{ $json['motivo nc'] }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Mercadería:</strong>\n                <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" \n                       style=\"width:100%; border-collapse:collapse; margin-top:10px;\">\n                  <thead>\n                    <tr>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Código</th>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Cantidad</th>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Producto</th>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Total</th>\n                    </tr>\n                  </thead>\n                  <tbody style=\"font-size:14px; line-height:1.4;\">\n                    {{ $json.mercaderia_tabla }}\n                  </tbody>\n                </table>\n              </div>\n\n              <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                PUEDE HACER SEGUIMIENTO DE LAS SOLICITUDES EN EL SIGUIENTE LINK:\n                <a href=\"https://link.heleo.com.pe/seguimiento_solicitudes\" style=\"color: #888888;\">https://link.heleo.com.pe/seguimiento_solicitudes</a>\n              </div>\n              <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                Este mensaje fue generado automáticamente a partir de un formulario de solicitud.\n                <a href=\"https://link.heleo.com.pe/solicitudes_documentos\" style=\"color: #888888;\">https://link.heleo.com.pe/solicitudes_documentos</a>\n              </div>\n\n            </td>\n          </tr>\n        </table>\n\n        <!--[if mso | IE]>\n          </td></tr>\n        </table>\n        <![endif]-->\n\n      </td>\n    </tr>\n  </table>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1712,-64],"id":"24444334-a2d6-4465-879a-94a8cb188aa9","name":"nota de credito"},{"parameters":{"authentication":"nocoDbApiToken","projectId":"pgdr03jv1pxs0up","table":"m15ssb58yi3alx5","id":"={{ $json.id }}"},"type":"n8n-nodes-base.nocoDb","typeVersion":3,"position":[688,-352],"id":"963a1923-5810-4bf2-a912-25f7a6f809f0","name":"Get a row","retryOnFail":true,"credentials":{"nocoDbApiToken":{"id":"VzaOAq3reUMnCYi4","name":"NocoDB Token account"}}},{"parameters":{"jsCode":"return {\n  urls: $json.adjuntos.map(a => a.signedUrl),\n  titulos: $json.adjuntos.map(a => a.title),\n  mimetype: $json.adjuntos.map(a => a.mimetype)\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1392,-576],"id":"be347d70-0aba-42c2-8c7a-c40d1a5157d6","name":"rutas"},{"parameters":{"jsCode":"return $json.urls.map((url, index) => ({\n  url,\n  titulo: $json.titulos[index],\n  mime: $json.mimetype[index],\n}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1728,-384],"id":"61c02a1d-2cc6-450c-a5cb-5f9b6fc29b70","name":"split"},{"parameters":{"jsCode":"const newItem = { json: {}, binary: {} };\n\nitems.forEach((item, index) => {\n  const binaryKey = Object.keys(item.binary)[0];\n  newItem.binary[`file${index + 1}`] = item.binary[binaryKey];\n});\n\nreturn [newItem];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2256,-384],"id":"0299b66e-b122-4f4c-96e0-e9da089c12f3","name":"join binary"},{"parameters":{"jsCode":"const item = items[0]; // Un solo item con todos los binarios\nconst attachmentKeys = Object.keys(item.binary);\n\n// Guardamos la lista de attachments en el JSON para que el nodo Email la use\nitem.json.attachmentsList = attachmentKeys.join(',');\nreturn [item];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2480,-384],"id":"fd8a4098-14e6-46f7-abd7-2a6c80977230","name":"nombres"},{"parameters":{"fromEmail":"={{ $('Switch').item.json['correo solicitante'] }}","toEmail":"={{ $('valores cargados').item.json['correo solicitante'] }}","subject":"Solicitud de Nota de Credito","html":"={{ $json.html }}","options":{"appendAttribution":false,"attachments":"={{ $json.attachmentsList }}"}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[2976,16],"id":"1cac4957-d874-4111-be4e-b2046668029c","name":"envio de solicitud de NC","webhookId":"9179849f-f2eb-4954-9351-10bd2f1efe2d","credentials":{"smtp":{"id":"k3JRkY41OWD5lbru","name":"enviador de correos de workflows"}},"onError":"continueRegularOutput"},{"parameters":{"fromEmail":"{{ $('Switch').item.json['correo solicitante'] }}","toEmail":"={{ $('valores cargados').item.json['correo solicitante'] }}","subject":"=Solicitud de {{ $('valores cargados').item.json.requerimiento }}","html":"={{ $json.html }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[992,416],"id":"4a881bfb-5e30-4a47-bf4b-eca30144bdad","name":"correo para anulacion de comprobante","webhookId":"9179849f-f2eb-4954-9351-10bd2f1efe2d","credentials":{"smtp":{"id":"k3JRkY41OWD5lbru","name":"enviador de correos de workflows"}},"onError":"continueRegularOutput"},{"parameters":{"fromEmail":"{{ $('Switch').item.json['correo solicitante'] }}","toEmail":"={{ $('valores cargados').item.json['correo solicitante'] }}","subject":"Anulacion de Guia de Remision","html":"={{ $json.html }}","options":{"appendAttribution":false}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1664,960],"id":"0586da8f-3775-41fc-8385-972c217923cd","name":"correo para anulacion de guia","webhookId":"9179849f-f2eb-4954-9351-10bd2f1efe2d","credentials":{"smtp":{"id":"k3JRkY41OWD5lbru","name":"enviador de correos de workflows"}},"onError":"continueRegularOutput"},{"parameters":{"modelName":"models/gemini-2.5-flash-lite","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1104,64],"id":"4b1dc24c-fc68-45bb-a61f-7a9d4173cfa9","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"FCkOHRpbraeLDbx7","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"text":"={{ $json.mercaderia }}","schemaType":"fromJson","jsonSchemaExample":"[\n  { \"codigo\": \"998\", \"cantidad\": \"50\", \"producto\": \"Cemento rápido - 25kg\", \"total\": \"500\" },\n  { \"codigo\": \"1120\", \"cantidad\": \"36\", \"producto\": \"Fragua Weber Blanco\", \"total\": \"230\" }\n]\n","options":{"systemPromptTemplate":"You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value.\nIf you know the attribute exists but its value is unknown, output a single space (\" \") as its value."}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1.2,"position":[944,-112],"id":"4a6d2b9b-19ef-482a-9140-1a7aa3be7a49","name":"Information Extractor","retryOnFail":true},{"parameters":{"jsCode":"// Tomamos el array de productos\nconst productos = $json.output || [];\n\n// Generamos las filas HTML\nconst filas = productos.map(p => `\n  <tr>\n    <td>${p.codigo || ''}</td>\n    <td>${p.cantidad || ''}</td>\n    <td>${p.producto || ''}</td>\n    <td>${p.total || ''}</td>\n  </tr>\n`).join(\"\");\n\n// Retornamos el HTML listo para la tabla\nreturn [{\n  json: {\n    mercaderia_tabla: filas\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1344,-16],"id":"25f5cc13-55dc-4521-8aad-89255b79378b","name":"Code"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1248,-192],"id":"981f28d5-8b5b-479e-9e1a-9f4a1ee3f0ec","name":"Merge"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2976,-208],"id":"b932d8e6-bfdd-4ee8-a692-1e3bff973888","name":"Merge1"},{"parameters":{"content":"## Solicitud de Nota de Credito\ncopia de correo para los solictantes","height":656,"width":2800},"type":"n8n-nodes-base.stickyNote","position":[576,-448],"typeVersion":1,"id":"8609d121-4ae2-43b9-99f0-7dd31d4e2240","name":"Sticky Note"},{"parameters":{"content":"## Solicitud de Anulacion de comprobante de venta\ncopia de correo para los solictantes","height":400,"width":832,"color":3},"type":"n8n-nodes-base.stickyNote","position":[576,224],"typeVersion":1,"id":"20df2b4e-eb61-4c2e-9a59-986f175988be","name":"Sticky Note1"},{"parameters":{"content":"## Solicitud de Anulacion de guia de remision\ncopia de correo para los solictantes","height":560,"width":2144,"color":5},"type":"n8n-nodes-base.stickyNote","position":[560,880],"typeVersion":1,"id":"da7117c4-459a-4193-94d7-cf58a02be7ed","name":"Sticky Note2"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Solicitud de {{ $json.requerimiento }}</title>\n  <meta name=\"x-apple-disable-message-reformatting\">\n</head>\n<body style=\"margin:0; padding:0; background:#f8f9fa;\">\n  <!-- Wrapper a 100% para fondo -->\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%; border-collapse:collapse; background:#f8f9fa;\">\n    <tr>\n      <td align=\"center\" style=\"padding:20px 10px;\">\n        \n        <!--[if mso | IE]>\n        <table role=\"presentation\" width=\"650\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n          <tr><td>\n        <![endif]-->\n\n        <!-- Contenedor fijo 650px -->\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"650\" \n               style=\"width:650px; max-width:650px; min-width:650px; border-collapse:separate; border:1px solid #e0e0e0; border-radius:8px; background:#ffffff;\">\n          <tr>\n            <td style=\"padding:20px; font-family:Arial, Helvetica, sans-serif; color:#333;\">\n              \n              <h2 style=\"margin:0 0 20px; font-size:22px; line-height:1.3; text-align:center; color:#0056b3;\">\n                Solicitud de {{ $json.requerimiento }}\n              </h2>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Solicitado por:</strong> {{ $json.solicitante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Autorizado por:</strong> {{ $json.autorizador }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Comprobante:</strong> {{ $json.comprobante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Estado de la Mercadería:</strong> {{ $json['estado  mercaderia'] }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Nombre Cliente:</strong> {{ $json.cliente }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Motivo:</strong> {{ $json['motivo nc'] }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Mercadería:</strong> {{ $json['estado  mercaderia'] }}\n                <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" \n                       style=\"width:100%; border-collapse:collapse; margin-top:10px;\">\n                  <thead>\n                    <tr>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Código</th>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Cantidad</th>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Producto</th>\n                      <th style=\"border:1px solid #ddd; padding:8px; text-align:left; background:#f2f2f2; color:#333; font-weight:bold; font-size:14px;\">Total</th>\n                    </tr>\n                  </thead>\n                  <tbody style=\"font-size:14px; line-height:1.4;\">\n                    {{ $json.mercaderia_tabla }}\n                  </tbody>\n                </table>\n              </div>          \n\n            </td>\n          </tr>\n           <tr>\n      <td colspan=\"2\" style=\"padding: 15px; border: 1px solid #dddddd; background-color: #f9f9f9;\">\n        Para confirmar que la atención de solicitud ha sido atendida, por favor, haz clic en el siguiente enlace:\n      </td>\n    </tr>\n    <tr>\n  <td colspan=\"2\" align=\"center\" style=\"padding: 20px; border: 1px solid #dddddd;\">\n    <a \n      href=\"https://ene8w.heleo.com.pe/webhook/sl?request_id={{ $json.id }}\" \n      target=\"_blank\" \n      style=\"display: inline-block; padding: 10px 15px; font-size: 16px; color: #ffffff; background-color: #007bff; text-decoration: none; border-radius: 5px;\"\n    >\n      Confirmar Atención de Solicitud\n    </a>\n  </td>\n</tr>\n        </table>\n        <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                PUEDE HACER SEGUIMIENTO DE LAS SOLICITUDES EN EL SIGUIENTE LINK:\n                <a href=\"https://link.heleo.com.pe/seguimiento_solicitudes\" style=\"color: #888888;\">https://link.heleo.com.pe/seguimiento_solicitudes</a>\n              </div>\n\n        <!--[if mso | IE]>\n          </td></tr>\n        </table>\n        <![endif]-->\n\n      </td>\n    </tr>\n  </table>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[2112,320],"id":"bf0f8f7c-9404-401a-aeac-40e034405f13","name":"nota de credito1"},{"parameters":{"content":"## Copia de correo al destinatario","height":544,"width":1952,"color":6},"type":"n8n-nodes-base.stickyNote","position":[1424,224],"typeVersion":1,"id":"c3154afd-75c8-4e16-9157-f2fc47475f18","name":"Sticky Note4"},{"parameters":{"fromEmail":"={{ $('Switch').item.json[\"correo solicitante\"] }}","toEmail":"={{ $json['correos receptores'] }}","subject":"=Solicitud de  {{ $('valores cargados').item.json.requerimiento }}","html":"={{ $json.html }}","options":{"appendAttribution":false,"attachments":"={{ $json.attachmentsList }}"}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[3104,464],"id":"a37eafc1-0d18-4ffb-b517-35043a9ae9c9","name":"envio de copia de solicitud","webhookId":"9179849f-f2eb-4954-9351-10bd2f1efe2d","credentials":{"smtp":{"id":"k3JRkY41OWD5lbru","name":"enviador de correos de workflows"}},"onError":"continueRegularOutput"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Solicitud de Anulación de Guía de Remisión</title>\n  <meta name=\"x-apple-disable-message-reformatting\">\n</head>\n<body style=\"margin:0; padding:0; background:#f8f9fa;\">\n  <!-- Fondo general -->\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%; border-collapse:collapse; background:#f8f9fa;\">\n    <tr>\n      <td align=\"center\" style=\"padding:20px 10px;\">\n\n        <!--[if mso | IE]>\n        <table role=\"presentation\" width=\"600\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n          <tr><td>\n        <![endif]-->\n\n        <!-- Contenedor principal -->\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"600\"\n               style=\"width:600px; max-width:600px; min-width:600px; border-collapse:separate; border:1px solid #e0e0e0; border-radius:8px; background:#ffffff;\">\n          <tr>\n            <td style=\"padding:20px; font-family:Arial, Helvetica, sans-serif; color:#333;\">\n\n              <h2 style=\"margin:0 0 20px; font-size:22px; line-height:1.3; text-align:center; color:#0056b3;\">\n                Solicitud de Anulación de Guía de Remisión\n              </h2>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Solicitado por:</strong> {{ $json.solicitante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Guía:</strong> {{ $json.guia }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Motivo de Anulación:</strong><br>\n                {{ $json['motivo anulacion'] }}\n              </div>       \n\n            </td>\n          </tr>\n<tr>\n  <td colspan=\"2\" align=\"center\" style=\"padding: 20px; border: 1px solid #dddddd;\">\n    <a \n      href=\"https://ene8w.heleo.com.pe/webhook/sl?request_id={{ $json.id }}\" \n      target=\"_blank\" \n      style=\"display: inline-block; padding: 10px 15px; font-size: 16px; color: #ffffff; background-color: #007bff; text-decoration: none; border-radius: 5px;\"\n    >\n      Confirmar Atención de Solicitud\n    </a>\n  </td>\n</tr>\n        </table>\n        <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                PUEDE HACER SEGUIMIENTO DE LAS SOLICITUDES EN EL SIGUIENTE LINK:\n                <a href=\"https://link.heleo.com.pe/seguimiento_solicitudes\" style=\"color: #888888;\">https://link.heleo.com.pe/seguimiento_solicitudes</a>\n              </div>\n        <!--[if mso | IE]>\n          </td></tr>\n        </table>\n        <![endif]-->\n\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1696,528],"id":"14038cb7-2e9a-4721-85ae-c0c2b8cd419a","name":"anulacion de guia1"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Solicitud de Anulación de Comprobante</title>\n  <meta name=\"x-apple-disable-message-reformatting\">\n</head>\n<body style=\"margin:0; padding:0; background:#f8f9fa;\">\n  <!-- Fondo general -->\n  <table role=\"presentation\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%; border-collapse:collapse; background:#f8f9fa;\">\n    <tr>\n      <td align=\"center\" style=\"padding:20px 10px;\">\n\n        <!--[if mso | IE]>\n        <table role=\"presentation\" width=\"600\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n          <tr><td>\n        <![endif]-->\n\n        <!-- Contenedor blanco -->\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"600\"\n               style=\"width:600px; max-width:600px; min-width:600px; border-collapse:separate; border:1px solid #e0e0e0; border-radius:8px; background:#ffffff;\">\n          <tr>\n            <td style=\"padding:20px; font-family:Arial, Helvetica, sans-serif; color:#333;\">\n\n              <h2 style=\"margin:0 0 20px; font-size:22px; line-height:1.3; text-align:center; color:#0056b3;\">\n                Solicitud de Anulación de Comprobante\n              </h2>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Solicitado por:</strong> {{ $json.solicitante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Guía:</strong> {{ $json.guia }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Número de Comprobante:</strong> {{ $json.comprobante }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Importe de Comprobante:</strong> {{ $json.importe }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Comprobante de Reemplazo:</strong> {{ $json['nuevo comprobante'] }}\n              </div>\n\n              <div style=\"margin:0 0 15px; font-size:14px; line-height:1.5;\">\n                <strong style=\"color:#444;\">Motivo de Anulación:</strong><br>\n                {{ $json['motivo anulacion'] }}\n              </div>              \n\n            </td>\n          </tr>\n<tr>\n  <td colspan=\"2\" align=\"center\" style=\"padding: 20px; border: 1px solid #dddddd;\">\n    <a \n      href=\"https://ene8w.heleo.com.pe/webhook/sl?request_id={{ $json.id }}\" \n      target=\"_blank\" \n      style=\"display: inline-block; padding: 10px 15px; font-size: 16px; color: #ffffff; background-color: #007bff; text-decoration: none; border-radius: 5px;\"\n    >\n      Confirmar Atención de Solicitud\n    </a>\n  </td>\n</tr>\n        </table>\n         <div style=\"margin-top:20px; font-size:12px; color:#777; text-align:center; border-top:1px solid #e0e0e0; padding-top:10px;\">\n                PUEDE HACER SEGUIMIENTO DE LAS SOLICITUDES EN EL SIGUIENTE LINK:\n                <a href=\"https://link.heleo.com.pe/seguimiento_solicitudes\" style=\"color: #888888;\">https://link.heleo.com.pe/seguimiento_solicitudes</a>\n              </div>\n        <!--[if mso | IE]>\n          </td></tr>\n        </table>\n        <![endif]-->\n\n      </td>\n    </tr>\n  </table>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1872,416],"id":"150fcdaf-50cf-4b7c-83ca-95cb48b12a60","name":"html anulacion","alwaysOutputData":true,"notesInFlow":false},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2752,288],"id":"b656095c-dc70-4ba2-92cc-7555549afe39","name":"Merge3"},{"parameters":{"url":"={{ $json.url }}","options":{"response":{"response":{"responseFormat":"file","outputPropertyName":"={{ $json.titulo }}"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2032,-384],"id":"e3c8966b-9615-44ec-8165-7dbd21e9cfde","name":"recupera adjuntos","retryOnFail":true},{"parameters":{"authentication":"nocoDbApiToken","operation":"getAll","projectId":"pgdr03jv1pxs0up","table":"mlzp2itrhk2iut6","options":{"viewId":"vwhj54lx2flyckf5"}},"type":"n8n-nodes-base.nocoDb","typeVersion":3,"position":[32,176],"id":"7a077e0f-1552-440e-8eff-f2076fac5472","name":"receptores","retryOnFail":true,"waitBetweenTries":2000,"credentials":{"nocoDbApiToken":{"id":"VzaOAq3reUMnCYi4","name":"NocoDB Token account"}}},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"Correo"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[48,384],"id":"6f000ba2-5bfd-4fd0-86b0-53c8c356e063","name":"Aggregate"},{"parameters":{"assignments":{"assignments":[{"id":"9e31ff6f-aef6-4bf8-ab0c-e258a1f9e77c","name":"correos receptores","value":"={{ $json.Correo.join(';') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[64,624],"id":"2e158049-a6b8-4df9-a935-5f880265f11b","name":"listado correos"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2768,608],"id":"1262c961-c406-4842-a66d-579c7f01f771","name":"Merge5"},{"parameters":{"assignments":{"assignments":[{"id":"aed67bf7-489e-4931-8e03-7cd2a27c4f49","name":"urls","value":"={{ $json[\"adjuntos\"].map(a => a.signedUrl) }}","type":"array"},{"id":"b2e41c5a-1cb2-4dc0-9402-ab55e6b7fb79","name":"titulos","value":"={{ $json[\"adjuntos\"].map(a => a.title) }}","type":"array"},{"id":"5bded2ba-3d2d-4ee0-b41b-7c7feaebe43a","name":"mimetype","value":"={{ $json[\"adjuntos\"].map(a => a.mimetype) }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1392,-416],"id":"c922cf77-77dd-4842-96b9-5fc010531bcb","name":"Edit Fields"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"464bae20-3c7e-4786-a41b-d9688526c422","leftValue":"={{ $json.adjuntos[0] }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1056,-336],"id":"f24f827a-03e0-4f11-ac38-c8f00df3700a","name":"con adjunto"},{"parameters":{"assignments":{"assignments":[{"id":"c911363c-fc3e-4c42-a021-57969accb0b0","name":"attachmentsList","value":"","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1856,-224],"id":"7cbaafec-af4f-408d-b5ce-007912c36e56","name":"variable en blanco"}],"connections":{"Webhook":{"main":[[{"node":"valores cargados","type":"main","index":0},{"node":"receptores","type":"main","index":0}]]},"valores cargados":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Get a row","type":"main","index":0},{"node":"Information Extractor","type":"main","index":0},{"node":"Merge","type":"main","index":0}],[{"node":"anulacion comprobantes","type":"main","index":0},{"node":"html anulacion","type":"main","index":0}],[{"node":"anulacion de guia","type":"main","index":0},{"node":"anulacion de guia1","type":"main","index":0}]]},"anulacion comprobantes":{"main":[[{"node":"correo para anulacion de comprobante","type":"main","index":0}]]},"anulacion de guia":{"main":[[{"node":"correo para anulacion de guia","type":"main","index":0}]]},"Get a row":{"main":[[{"node":"con adjunto","type":"main","index":0}]]},"nota de credito":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"rutas":{"main":[[]]},"split":{"main":[[{"node":"recupera adjuntos","type":"main","index":0}]]},"join binary":{"main":[[{"node":"nombres","type":"main","index":0}]]},"nombres":{"main":[[{"node":"Merge1","type":"main","index":0},{"node":"Merge3","type":"main","index":0}]]},"envio de solicitud de NC":{"main":[[]]},"correo para anulacion de comprobante":{"main":[[]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]},"Information Extractor":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"nota de credito","type":"main","index":0},{"node":"nota de credito1","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"envio de solicitud de NC","type":"main","index":0}]]},"nota de credito1":{"main":[[{"node":"Merge3","type":"main","index":1}]]},"html anulacion":{"main":[[{"node":"Merge5","type":"main","index":0}]]},"anulacion de guia1":{"main":[[{"node":"Merge5","type":"main","index":0}]]},"Merge3":{"main":[[{"node":"Merge5","type":"main","index":0}]]},"recupera adjuntos":{"main":[[{"node":"join binary","type":"main","index":0}]]},"receptores":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"listado correos","type":"main","index":0}]]},"listado correos":{"main":[[{"node":"Merge5","type":"main","index":1}]]},"Merge5":{"main":[[{"node":"envio de copia de solicitud","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"split","type":"main","index":0}]]},"con adjunto":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"variable en blanco","type":"main","index":0}]]},"variable en blanco":{"main":[[{"node":"Merge1","type":"main","index":0},{"node":"Merge3","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"P2KNQOljSeBCsYgy"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"d2aa6ce1-1434-4fb8-8429-bd77ac1346c4","triggerCount":1,"shared":[{"createdAt":"2025-08-07T18:15:24.270Z","updatedAt":"2025-08-07T18:15:24.270Z","role":"workflow:owner","workflowId":"kwd4LZfacoaZVTyS","projectId":"SqMi70IbghSQH4eu"}],"tags":[]}