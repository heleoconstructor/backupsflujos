{"createdAt":"2025-10-11T21:21:56.901Z","updatedAt":"2025-10-13T05:42:05.684Z","id":"WYPpdoOAZOgVXmcb","name":"REGISTRO DE GASTOS copy","active":false,"isArchived":false,"nodes":[{"parameters":{"content":"whitelist","height":240,"width":1140},"type":"n8n-nodes-base.stickyNote","position":[-3776,608],"typeVersion":1,"id":"a3128ace-186e-4d93-88f0-d8b3da75694a","name":"Sticky Note"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.content_type }}","rightValue":"audio","operator":{"type":"string","operation":"equals"},"id":"6970faf6-9d4f-4371-b00a-ba867e978121"}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"81257730-8d8d-4b11-bae1-f1b01ab09856","leftValue":"={{ $json.message.content_type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"51f35c3d-9e46-4531-b5db-0a3e6a4b4211","leftValue":"={{ $json.message.content_type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"Other"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2432,640],"id":"9528c535-c9a3-45c2-a0c4-91e0d2ac31aa","name":"tipo dato"},{"parameters":{"assignments":{"assignments":[{"id":"e3d8e45d-6ec7-40c7-8ad0-cf6822baaf0b","name":"instance.server_url","value":"={{ $('recibe whatsapp').item.json.body.server_url }}","type":"string"},{"id":"c94fd657-20eb-4d75-87c1-9aad99dd8068","name":"instance.nombre","value":"={{ $('recibe whatsapp').item.json.body.instance }}","type":"string"},{"id":"af61c2a0-54a0-4a34-b6eb-9ccbfadda86b","name":"instance.apikey","value":"={{ $('recibe whatsapp').item.json.body.apikey }}","type":"string"},{"id":"ffc263bd-0a90-4f50-84f1-e3f87474eb01","name":"message.from","value":"={{ $('recibe whatsapp').item.json.body.data.key.remoteJid }}\n","type":"string"},{"id":"65c29034-84d4-4168-bbf0-267b0553d7d3","name":"message.id","value":"={{ $('recibe whatsapp').item.json.body.data.key.id }}","type":"string"},{"id":"9f458742-29f6-4ff8-b54d-537e3bd5bef0","name":"message.content_type","value":"={{ $('recibe whatsapp').item.json.body.data.message.extendedTextMessage ? 'text': '' }}{{ $('recibe whatsapp').item.json.body.data.message.conversation ? 'text': '' }}{{ $('recibe whatsapp').item.json.body.data.message.audioMessage ? 'audio': '' }}{{ $('recibe whatsapp').item.json.body.data.message.imageMessage ? 'image': '' }}","type":"string"},{"id":"2b442264-0eb6-4cb2-ab60-7e7953ddc67c","name":"message.content","value":"={{ $('recibe whatsapp').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('recibe whatsapp').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('recibe whatsapp').item.json.body.data.message.conversation || '' }}","type":"string"},{"id":"25250918-29b3-4e28-9b97-dd589825dc4e","name":"message.date","value":"={{ $('recibe whatsapp').item.json.body.date_time.toDateTime().toISO() }}","type":"string"},{"id":"ca801f80-75f8-4c0a-be9b-af56dd61f65a","name":"user.name","value":"={{ $('recibe whatsapp').item.json.body.data.pushName }}","type":"string"},{"id":"84f14250-c750-45ae-88a6-a04613c57de6","name":"keyapi.deepgram","value":"87347040d82c105d3f47de19f7582ae2bf341754","type":"string"},{"id":"9bc1e058-2a3f-4bc2-af42-20f2839e258c","name":"keyapi.llamacloud","value":"llx-8YVJLHZdOWSL0J4CEfDP7sV9UrgiLNZygPKB2S4RYbj51vVL","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2816,656],"id":"f6b7ae38-47f0-454f-885b-981f52f3e346","name":"set fields"},{"parameters":{"method":"POST","url":"={{ $json.instance.server_url }}/chat/getBase64FromMediaMessage/{{ $json.instance.nombre }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.instance.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"message.key.id","value":"={{ $json.message.id }}"},{"name":"convertToMp4","value":"={{Boolean(false)}}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1296,272],"id":"0a929b59-1211-432a-8967-ec9268ea1093","name":"get audio"},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"file.ogg","mimeType":"={{ $json.mimetype }}"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1088,272],"id":"4b915e94-6b1a-43e6-9194-66efa2c16f8f","name":"Convert audio"},{"parameters":{"method":"POST","url":"https://api.deepgram.com/v1/listen","sendQuery":true,"queryParameters":{"parameters":[{"name":"punctuate","value":"true"},{"name":"model","value":"nova-2"},{"name":"language","value":"es-419"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Token {{ $('set fields').item.json.deepgram.keyapi }}"}]},"sendBody":true,"contentType":"binaryData","inputDataFieldName":"data","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1888,192],"id":"b2dfc4d8-c6b4-4a15-a378-a3da3002952d","name":"transcripcion","disabled":true},{"parameters":{"method":"POST","url":"https://api.groq.com/openai/v1/audio/transcriptions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"model","value":"whisper-large-v3-turbo"},{"name":"temperature","value":"0"},{"name":"response_format","value":"verbose_json"},{"name":"language","value":"es"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-896,272],"id":"263c13d9-535c-41c4-aa85-e6f33d7e60c1","name":"groq transcripci√≥n","credentials":{"httpHeaderAuth":{"id":"8PlaFYoc9ho8EcnX","name":"groq api n8n"}}},{"parameters":{"assignments":{"assignments":[{"id":"08ce01c6-96e0-4e0b-aa5d-11ee86a30d27","name":"markdown","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-640,272],"id":"97c9f98b-80bb-409e-a073-9c4cb20085ca","name":"audio normalizado"},{"parameters":{"method":"POST","url":"={{ $json.instance.server_url }}/chat/getBase64FromMediaMessage/{{ $json.instance.nombre }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.instance.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"message.key.id","value":"={{ $json.message.id }}"},{"name":"convertToMp4","value":"={{Boolean(false)}}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1568,640],"id":"2737434c-0bc8-4072-9bbb-e419dd250ab1","name":"get image"},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1392,640],"id":"1b66179d-b377-43f2-85ab-6c5b996227c9","name":"Convert image"},{"parameters":{"resource":"chat-api","operation":"read-messages","instanceName":"={{ $('set fields').item.json.instance.nombre }}","remoteJid":"={{ $('set fields').item.json.message.from }}","messageId":"={{ $('set fields').item.json.message.id }}"},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[704,672],"id":"b9826b3c-c264-4b62-afcf-0a8e4edfffb2","name":"Evolution API2","credentials":{"evolutionApi":{"id":"N4pL7HiqWBppbj8r","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"={{ $('set fields').item.json.instance.nombre }}","remoteJid":"={{ $('set fields').item.json.message.from }}","messageText":"=Enviaste este cpe {{ JSON.stringify($('Formatear datos').item.json.output) }}","options_message":{"delay":1200}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[880,672],"id":"0d95d946-3f0c-4751-b82d-7c9c3afc5c8b","name":"Evolution API3","credentials":{"evolutionApi":{"id":"N4pL7HiqWBppbj8r","name":"Evolution account"}}},{"parameters":{"content":"## transcribir audio \n","height":340,"width":1520,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-1984,144],"typeVersion":1,"id":"d2050c05-a6c0-4834-a939-f2b96cd86d79","name":"Sticky Note1"},{"parameters":{"content":"## extraer datos de factura de una imagen\n","height":400,"width":1520,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-1984,512],"typeVersion":1,"id":"d75deca9-77ee-4741-8b98-e235c549d30c","name":"Sticky Note2"},{"parameters":{"httpMethod":"POST","path":"9ccfb466-1004-4f48-8a12-f9a5422053ce","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-3712,672],"id":"8cd826ea-3e81-4e6d-bacf-8affc520f937","name":"recibe whatsapp","webhookId":"9ccfb466-1004-4f48-8a12-f9a5422053ce"},{"parameters":{"content":"## extraer datos de factura de un pdf\n","height":440,"width":1520,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1984,928],"typeVersion":1,"id":"01fe2e4d-cbcd-4125-bf39-fa3c565426bd","name":"Sticky Note3"},{"parameters":{"method":"POST","url":"={{ $json.instance.server_url }}/chat/getBase64FromMediaMessage/{{ $json.instance.nombre }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.instance.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"message.key.id","value":"={{ $json.message.id }}"},{"name":"convertToMp4","value":"={{Boolean(false)}}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1552,1040],"id":"e22f2675-9ef5-4304-a9d8-3f9d1c64a31a","name":"get pdf"},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1392,1040],"id":"a70f64a1-af92-47e1-8463-e165de9ca2dd","name":"guardar pdf"},{"parameters":{"method":"POST","url":"https://api.cloud.llamaindex.ai/api/parsing/upload","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"Authorization","value":"Bearer llx-8YVJLHZdOWSL0J4CEfDP7sV9UrgiLNZygPKB2S4RYbj51vVL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1216,1040],"id":"991fed94-b4d0-46fb-99e9-592625302e21","name":"subir pdf"},{"parameters":{"url":"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"Authorization","value":"=Bearer {{ $('set fields').item.json.keyapi.llamacloud }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1008,1040],"id":"47dd5021-c62d-4683-a5e7-c311295460a3","name":"verificar estado"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status }}","rightValue":"SUCCESS","operator":{"type":"string","operation":"equals"},"id":"966ecb8a-3b0b-4a69-84c9-eddf3eff7318"}],"combinator":"and"},"renameOutput":true,"outputKey":"SUCCESS"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a6e2cf8d-ae0e-47eb-adfd-1d9321b75dab","leftValue":"={{ $json.status }}","rightValue":"PENDING","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PENDING"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-832,1040],"id":"d3c17fbf-5b50-46b0-bf06-7dd319c2825b","name":"Switch"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-656,1152],"id":"f440178c-24e0-4b9c-8098-af9a6c1f938f","name":"Wait","webhookId":"c9b1f3bd-3dd5-4a9b-a966-515fbc4bb0f9"},{"parameters":{"url":"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}/result/markdown","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"Authorization","value":"=Bearer {{ $('set fields').item.json.keyapi.llamacloud }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-656,960],"id":"f674f846-d2df-4f43-960b-8d49acdf6f3e","name":"HTTP Request"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status }}","rightValue":"SUCCESS","operator":{"type":"string","operation":"equals"},"id":"966ecb8a-3b0b-4a69-84c9-eddf3eff7318"}],"combinator":"and"},"renameOutput":true,"outputKey":"SUCCESS"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a6e2cf8d-ae0e-47eb-adfd-1d9321b75dab","leftValue":"={{ $json.status }}","rightValue":"PENDING","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PENDING"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-816,640],"id":"af8ef943-c067-4ba0-a1bf-c7d8bfa179ee","name":"Switch1"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-640,704],"id":"b2bbc75c-cfe3-4da6-92a5-bc5a8922bc44","name":"Wait1","webhookId":"6b7fb4d9-18a1-4b52-96fb-ba7db13f0282"},{"parameters":{"url":"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}/result/markdown","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"Authorization","value":"=Bearer {{ $('set fields').item.json.keyapi.llamacloud }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-640,528],"id":"d0324ea6-7a72-47ef-8793-a53c33f93aed","name":"HTTP Request1"},{"parameters":{"method":"POST","url":"https://api.cloud.llamaindex.ai/api/parsing/upload","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"Authorization","value":"Bearer llx-8YVJLHZdOWSL0J4CEfDP7sV9UrgiLNZygPKB2S4RYbj51vVL"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1216,640],"id":"cc81fb4d-4dc9-4288-a43b-b2e1ac0cfe3d","name":"subir imagen"},{"parameters":{"url":"=https://api.cloud.llamaindex.ai/api/parsing/job/{{ $json.id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"Authorization","value":"=Bearer {{ $('set fields').item.json.keyapi.llamacloud }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-992,640],"id":"0688a332-f61a-4c75-9a83-3fe4e368b6c5","name":"verificar estado img"},{"parameters":{"promptType":"define","text":"={{ $json.markdown }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Eres un asistente que extrae informaci√≥n de gastos personales a partir de una transcripci√≥n de audio.\n\nLa fecha actual es {{$now}}.\n\nA partir del texto proporcionado, genera un objeto JSON con los siguientes campos:\n\n- descripcion: ¬øEn qu√© se gast√≥?\n- monto: ¬øCu√°nto se gast√≥? Solo el n√∫mero, sin s√≠mbolo de moneda.\n- moneda: Moneda utilizada (por ejemplo, \"PEN\", \"USD\").\n- fecha: Fecha del gasto (si no se menciona, usa la fecha actual).\n- metodo_pago: Forma de pago (efectivo, tarjeta, transferencia, etc.).\n- categoria: Categor√≠a general del gasto (alimentaci√≥n, transporte, salud, etc.).\n- fuente: Medio por el cual se registr√≥ (audio, imagen, PDF, etc.).\n- notas: Cualquier informaci√≥n adicional √∫til.\n\nYou must format your output as a JSON value that adheres to a given \"JSON Schema\" instance.\n\n\"JSON Schema\" is a declarative language that allows you to annotate and validate JSON documents.\n\nYour output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!\n\nHere is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:\n```json\n{\"type\":\"object\",\"properties\":{\"descripcion\":{\"type\":\"string\"},\"monto\":{\"type\":\"number\"},\"fecha\":{\"type\":\"string\"},\"metodo_pago\":{\"type\":\"string\"},\"categoria\":{\"type\":\"string\"}},\"additionalProperties\":false,\"$schema\":\"http://json-schema.org/draft-07/schema#\"}\n```\n\nEjemplo de salida:\n\n```json\n{\n  \"descripcion\": \"compra de gasolina\",\n  \"monto\": 80.50,\n  \"moneda\": \"PEN\",\n  \"fecha\": \"2025-05-06\",\n  \"metodo_pago\": \"tarjeta\",\n  \"categoria\": \"transporte\",\n  \"fuente\": \"audio\",\n  \"notas\": null\n}"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[-464,0],"id":"cbee1428-2b68-412b-be33-c78cf4d40cb3","name":"Basic LLM Chain"},{"parameters":{"jsonSchemaExample":"{\n  \"descripcion\": \"compra de gasolina\",\n  \"monto\": 80.50,\n  \"moneda\": \"PEN\",\n  \"fecha\": \"2025-05-06\",\n  \"metodo_pago\": \"tarjeta\",\n  \"categoria\": \"transporte\",\n  \"fuente\": \"audio\",\n  \"notas\": null\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[464,880],"id":"85da68eb-cb47-413c-b865-6f3005631f77","name":"Structured Output Parser"},{"parameters":{"promptType":"define","text":"={{ $json.markdown }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Eres un asistente que extrae informaci√≥n de gastos personales a partir un texto.\n\nLa fecha actual es {{$now}}.\n\nA partir del texto proporcionado, genera un objeto JSON con los siguientes campos:\n\n- descripcion: ¬øEn qu√© se gast√≥?\n- monto: ¬øCu√°nto se gast√≥? Solo el n√∫mero, sin s√≠mbolo de moneda.\n- moneda: Moneda utilizada (si no se menciona, usa \"PEN\").\n- fecha: Fecha del gasto (si no se menciona, usa la fecha actual en formato DD/MM/AAAA).\n- metodo_pago: Forma de pago (efectivo, tarjeta, transferencia, etc.).\n- categoria: Categor√≠a general del gasto (alimentaci√≥n, transporte, salud, etc.).\n- fuente: Medio por el cual se registr√≥ (audio, imagen, PDF, etc.).\n- notas: Cualquier informaci√≥n adicional √∫til.\n\n\n"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[304,640],"id":"65fa5ff5-fd06-4a91-a50f-4ed223172037","name":"Formatear datos"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[320,880],"id":"082ba947-cf6b-4122-bddf-d0340fa6e40a","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"FCkOHRpbraeLDbx7","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"amount":1},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[16,1440],"id":"1590d99e-ec8c-42a4-98df-3b5655a58af8","name":"Wait2","webhookId":"f654ebe9-7a93-4e6b-806b-1c7eaef860b3"},{"parameters":{"conversationKey":"={{ $json.message.from }}","messageField":"={{ $json.message.content }}"},"type":"n8n-nodes-message-buffer.messageBuffer","typeVersion":1,"position":[-224,1264],"id":"20bb3e4b-99be-4b58-8349-8b463f64a75b","name":"Message Buffer","credentials":{"redis":{"id":"ina424WXS84AZdi5","name":"Redis account"}}},{"parameters":{"content":"## seguridad","height":640,"width":576},"type":"n8n-nodes-base.stickyNote","position":[-320,1040],"typeVersion":1,"id":"559efef2-baa3-42df-aa9b-8a99dc88445c","name":"Sticky Note4"},{"parameters":{"authentication":"nocoDbApiToken","operation":"getAll","workspaceId":"wsz4x1lj","projectId":"pgukarxe1ax1kf4","table":"mhbct5pzxzep05y","options":{"where":"=(celular,like,{{ $json.body.data.key.remoteJid.replace('@s.whatsapp.net','') }})"}},"type":"n8n-nodes-base.nocoDb","typeVersion":3,"position":[-3440,672],"id":"54873324-bdba-4abd-9c73-ad7f7f7b85db","name":"whitelist1","credentials":{"nocoDbApiToken":{"id":"sg9AXpayfezBKp3A","name":"NocoDB Token cloud jd"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"4dc86c1f-e498-4094-809d-fe512b7ba1e5","leftValue":"={{ $input.all().map(item => item.json.celular).includes($('recibe whatsapp').item.json.body.data.key.remoteJid.replace('@s.whatsapp.net','')) }}","rightValue":"={{ $input.all().map(item => item.json.celular) }}","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3136,672],"id":"1a3f4a37-a90a-401b-9da8-5add0cdd7e1b","name":"filtro"},{"parameters":{"chatId":"1855348433","text":"={{ $json.consolidatedMessage }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[48,1184],"id":"726b1439-d09b-4622-ad22-3a6a436258ce","name":"Send a text message","webhookId":"a0cd0767-17eb-4424-8e73-acd00b42a16c","credentials":{"telegramApi":{"id":"JapnsteBcRN5728Q","name":"Telegram account 1855348433"}}},{"parameters":{"resource":"audio","modelId":{"__rl":true,"value":"models/gemini-2.5-flash","mode":"list","cachedResultName":"models/gemini-2.5-flash"},"options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-944,-64],"id":"188e2255-6176-4a24-82fa-26eeea41a53e","name":"Transcribe a recording","credentials":{"googlePalmApi":{"id":"FCkOHRpbraeLDbx7","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"content":"## Mejor solucion\n**Hace una consulta directa a la whitelist si el numero existe"},"type":"n8n-nodes-base.stickyNote","position":[-3488,432],"typeVersion":1,"id":"b723766e-e3cd-4aac-a003-e6e157cf9afb","name":"Sticky Note5"}],"connections":{"tipo dato":{"main":[[{"node":"get audio","type":"main","index":0}],[{"node":"get image","type":"main","index":0}],[{"node":"Message Buffer","type":"main","index":0}],[{"node":"get pdf","type":"main","index":0}]]},"set fields":{"main":[[{"node":"tipo dato","type":"main","index":0}]]},"get audio":{"main":[[{"node":"Convert audio","type":"main","index":0}]]},"Convert audio":{"main":[[{"node":"groq transcripci√≥n","type":"main","index":0}]]},"groq transcripci√≥n":{"main":[[{"node":"audio normalizado","type":"main","index":0}]]},"audio normalizado":{"main":[[{"node":"Formatear datos","type":"main","index":0}]]},"get image":{"main":[[{"node":"Convert image","type":"main","index":0}]]},"Convert image":{"main":[[{"node":"subir imagen","type":"main","index":0}]]},"Evolution API2":{"main":[[{"node":"Evolution API3","type":"main","index":0}]]},"recibe whatsapp":{"main":[[{"node":"whitelist1","type":"main","index":0}]]},"get pdf":{"main":[[{"node":"guardar pdf","type":"main","index":0}]]},"guardar pdf":{"main":[[{"node":"subir pdf","type":"main","index":0}]]},"subir pdf":{"main":[[{"node":"verificar estado","type":"main","index":0}]]},"verificar estado":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"verificar estado","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Formatear datos","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"HTTP Request1","type":"main","index":0}],[{"node":"Wait1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"verificar estado img","type":"main","index":0}]]},"HTTP Request1":{"main":[[{"node":"Formatear datos","type":"main","index":0}]]},"subir imagen":{"main":[[{"node":"verificar estado img","type":"main","index":0}]]},"verificar estado img":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Formatear datos","type":"ai_outputParser","index":0}]]},"Formatear datos":{"main":[[{"node":"Evolution API2","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Formatear datos","type":"ai_languageModel","index":0}]]},"Wait2":{"main":[[{"node":"Message Buffer","type":"main","index":0}]]},"Message Buffer":{"main":[[{"node":"Send a text message","type":"main","index":0}],[{"node":"Wait2","type":"main","index":0}]]},"whitelist1":{"main":[[{"node":"filtro","type":"main","index":0}]]},"filtro":{"main":[[{"node":"set fields","type":"main","index":0}]]},"Send a text message":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"P2KNQOljSeBCsYgy"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"recibe whatsapp":[{"json":{"headers":{"host":"ene8w.heleo.com.pe","user-agent":"axios/1.10.0","content-length":"6383","accept":"application/json, text/plain, */*","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"ene8w.heleo.com.pe","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"e1a79d945b11","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"agente financiero","data":{"key":{"remoteJid":"51952373850@s.whatsapp.net","fromMe":false,"id":"AC3A534D9CB2623142EFDDE9DF902264","senderLid":"138748985655322@lid"},"pushName":"Jesus Arenas","status":"DELIVERY_ACK","message":{"audioMessage":{"url":"https://mmg.whatsapp.net/v/t62.7117-24/559818777_1525539725284618_1040751479352679754_n.enc?ccb=11-4&oh=01_Q5Aa2gEiYB6MGBA2q-BlToVpL48_p6Di7firLl7q9AwK0hXKww&oe=690A0646&_nc_sid=5e03e0&mms3=true","mimetype":"audio/ogg; codecs=opus","fileSha256":"5DyRu8AVumRE2A8NZmgAKyavLIj54+gSHrT+VBxQ8cE=","fileLength":"3290","seconds":1,"ptt":true,"mediaKey":"QX/id2OaFVMFg4shhE31DrR58Bk2iQn4Bj0qffQqmoY=","fileEncSha256":"/SE6EhhpX+P2Qenm5F3BtH7SK6iLshQBL6uGDZR9C4E=","directPath":"/v/t62.7117-24/559818777_1525539725284618_1040751479352679754_n.enc?ccb=11-4&oh=01_Q5Aa2gEiYB6MGBA2q-BlToVpL48_p6Di7firLl7q9AwK0hXKww&oe=690A0646&_nc_sid=5e03e0","mediaKeyTimestamp":"1759681954","contextInfo":{"entryPointConversionSource":"global_search_new_chat","entryPointConversionApp":"whatsapp","entryPointConversionDelaySeconds":5},"waveform":"AAAGISQJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcRLkhTV1FKREE8Lx8JAAAAAAAAAAAAAAAAAAAAAAAAAA=="},"messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"XpIuZy875nWuMw==","senderTimestamp":"1759607364","recipientKeyHash":"hxb6AZWoY+oQ9A==","recipientTimestamp":"1758972695"},"deviceListMetadataVersion":2,"messageSecret":"ig7QVMxUsB5K5fZg08QOoOHPCT6CPhoSWnyPRXZSMCk="},"base64":"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"},"contextInfo":{"entryPointConversionSource":"global_search_new_chat","entryPointConversionApp":"whatsapp","entryPointConversionDelaySeconds":5},"messageType":"audioMessage","messageTimestamp":1759681954,"instanceId":"1601078f-45da-46b5-9a83-c49b4143f3e9","source":"android"},"destination":"https://ene8w.heleo.com.pe/webhook/recepcionwp","date_time":"2025-10-05T13:32:35.345Z","sender":"51917381920@s.whatsapp.net","server_url":"https://evoapi.heleo.com.pe","apikey":"D5FEEC92EABF-4073-94D9-613BF0CB489B"},"webhookUrl":"https://ene8w.heleo.com.pe/webhook/recepcionwp","executionMode":"production"}}]},"versionId":"532e8491-e1d4-408b-a99a-074ac6a411e0","triggerCount":1,"shared":[{"createdAt":"2025-10-11T21:21:56.901Z","updatedAt":"2025-10-11T21:21:56.901Z","role":"workflow:owner","workflowId":"WYPpdoOAZOgVXmcb","projectId":"SqMi70IbghSQH4eu"}],"tags":[]}